<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Servant Summit Church</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            /* Keep overall background white */
            background: #ffffff;
        }
        
        .warm-shadow {
            /* Subtle gold-tinted shadow */
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.12);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.35);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(100, 116, 139, 0.3);
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #f4d03f 0%, #d4af37 100%);
            color: white;
        }
        
        .dashboard-section {
            display: none;
        }
        
        .dashboard-section.active {
            display: block;
        }
        
        .stat-card {
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        table {
            border-collapse: collapse;
        }
        
        tbody tr {
            transition: all 0.2s ease;
        }
        
        tbody tr:hover {
            background-color: #fef3c7;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Gold theme overrides to complement purple */
        .theme-gold .text-amber-900 { color: #8a6d1f !important; }
        .theme-gold .text-amber-800 { color: #a07f1a !important; }
        .theme-gold .text-amber-700, .theme-gold .text-amber-701 { color: #b98f1d !important; }
        .theme-gold .text-amber-600 { color: #caa431 !important; }

        .theme-gold .border-amber-200 { border-color: #fde68a !important; }
        .theme-gold .border-amber-300 { border-color: #fcd34d !important; }
        .theme-gold .border-amber-500 { border-color: #eab308 !important; }
        .theme-gold .border-amber-600 { border-color: #ca8a04 !important; }

        .theme-gold .bg-amber-50 { background-color: #fffbeb !important; }
        .theme-gold .bg-amber-100 { background-color: #fef9c3 !important; }

        .theme-gold .hover\:bg-amber-50:hover { background-color: #fef9c3 !important; }

        /* Convert orange/amber gradients to gold */
        .theme-gold .from-orange-400 { --tw-gradient-from: #facc15 !important; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgb(250 204 21 / 0)) !important; }
        .theme-gold .to-amber-600 { --tw-gradient-to: #ca8a04 !important; }
        .theme-gold .from-amber-400 { --tw-gradient-from: #facc15 !important; }
        .theme-gold .to-amber-600 { --tw-gradient-to: #ca8a04 !important; }
        
        /* Focus ring tint approximation for gold */
        .theme-gold .focus\:ring-amber-400:focus { --tw-ring-color: #facc15 !important; }
    </style>
</head>
<body class="gradient-bg min-h-screen theme-gold">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center px-6">
        <div class="bg-white rounded-2xl p-8 warm-shadow max-w-md w-full">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-amber-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-2xl">S</span>
                </div>
                <h1 class="text-3xl font-bold text-amber-900 mb-2">Admin Dashboard</h1>
                <p class="text-amber-700">Servant Summit Church</p>
            </div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label class="block text-amber-800 font-medium mb-2">Username</label>
                    <input type="text" id="username" required class="w-full px-4 py-3 border border-amber-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                </div>
                
                <div class="mb-6">
                    <label class="block text-amber-800 font-medium mb-2">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 border border-amber-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                </div>
                
                <div id="loginError" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                    Invalid username or password
                </div>
                
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                    Sign In
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-amber-600">
                Demo credentials: admin / password
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="hidden">
        <!-- Top Navigation -->
        <nav class="bg-purple-700 sticky top-0 z-50 warm-shadow">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-amber-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-lg">S</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Admin Dashboard</h1>
                            <p class="text-xs text-purple-100">Servant Summit Church</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right hidden md:block">
                            <p class="text-sm font-medium text-white" id="adminName">Admin User</p>
                            <p class="text-xs text-purple-100">Church Administrator</p>
                        </div>
                        <button onclick="handleLogout()" class="px-4 py-2 border-2 border-purple-200 text-white rounded-lg font-semibold hover:bg-purple-600/60 transition-all">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Stats Overview -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-amber-700 text-sm font-medium">Total Members</span>
                        <span class="text-2xl">üë•</span>
                    </div>
                    <div class="text-3xl font-bold text-amber-900" id="totalMembers">0</div>
                </div>
                
                <div class="stat-card bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-amber-700 text-sm font-medium">Upcoming Events</span>
                        <span class="text-2xl">üìÖ</span>
                    </div>
                    <div class="text-3xl font-bold text-amber-900" id="totalEvents">0</div>
                </div>
                
                <div class="stat-card bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-amber-700 text-sm font-medium">Messages</span>
                        <span class="text-2xl">‚úâÔ∏è</span>
                    </div>
                    <div class="text-3xl font-bold text-amber-900" id="totalMessages">0</div>
                </div>
                
                <div class="stat-card bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-amber-700 text-sm font-medium">Donations</span>
                        <span class="text-2xl">üí∞</span>
                    </div>
                    <div class="text-3xl font-bold text-amber-900" id="totalDonations">0</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white rounded-xl p-2 warm-shadow mb-6 flex flex-wrap gap-2">
                <button onclick="showSection('members')" class="tab-button active px-6 py-3 rounded-lg font-semibold text-amber-800">
                    Members
                </button>
                <button onclick="showSection('events')" class="tab-button px-6 py-3 rounded-lg font-semibold text-amber-800">
                    Events
                </button>
                <button onclick="showSection('messages')" class="tab-button px-6 py-3 rounded-lg font-semibold text-amber-800">
                    Messages
                </button>
                <button onclick="showSection('donations')" class="tab-button px-6 py-3 rounded-lg font-semibold text-amber-800">
                    Donations
                </button>
                <button onclick="showSection('gallery')" class="tab-button px-6 py-3 rounded-lg font-semibold text-amber-800">
                    Gallery
                </button>
            </div>

            <!-- Members Section -->
            <div id="membersSection" class="dashboard-section active">
                <div class="bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-amber-900">Registered Members</h2>
                        <input type="text" id="memberSearch" onkeyup="searchMembers()" placeholder="Search members..." class="px-4 py-2 border border-amber-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-amber-200">
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Name</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Email</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Phone</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Age Group</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Interests</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-amber-600">No members registered yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Events Section -->
            <div id="eventsSection" class="dashboard-section">
                <div class="bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Events Management</h2>
                        <button onclick="openEventModal()" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                            + Add Event
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-gray-200">
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Event Name</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Date</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Time</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Location</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody">
                                <!-- Events will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Messages Section -->
            <div id="messagesSection" class="dashboard-section">
                <div class="bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-amber-900">Contact Messages</h2>
                        <select id="messageFilter" onchange="filterMessages()" class="px-4 py-2 border border-amber-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400">
                            <option value="all">All Messages</option>
                            <option value="general">General Inquiry</option>
                            <option value="prayer">Prayer Request</option>
                            <option value="volunteer">Volunteer</option>
                            <option value="events">Event Info</option>
                            <option value="pastoral">Pastoral Care</option>
                        </select>
                    </div>
                    
                    <div class="space-y-4" id="messagesContainer">
                        <div class="text-center py-8 text-amber-600">No messages yet</div>
                    </div>
                </div>
            </div>

            <!-- Donations Section -->
            <div id="donationsSection" class="dashboard-section">
                <div class="bg-white rounded-xl p-6 warm-shadow">
                    <h2 class="text-2xl font-bold text-amber-900 mb-6">Donation Records</h2>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
                            <div class="text-sm text-amber-700 mb-1">Total This Month</div>
                            <div class="text-2xl font-bold text-amber-900" id="monthlyTotal">$0.00</div>
                        </div>
                        <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
                            <div class="text-sm text-amber-700 mb-1">Total This Year</div>
                            <div class="text-2xl font-bold text-amber-900" id="yearlyTotal">$0.00</div>
                        </div>
                        <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
                            <div class="text-sm text-amber-700 mb-1">Average Donation</div>
                            <div class="text-2xl font-bold text-amber-900" id="averageDonation">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-amber-200">
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Donor</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Amount</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Type</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Frequency</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Date</th>
                                </tr>
                            </thead>
                            <tbody id="donationsTableBody">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-amber-600">No donations recorded</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gallery Section -->
            <div id="gallerySection" class="dashboard-section">
                <div class="bg-white rounded-xl p-6 warm-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-amber-900">Gallery Management</h2>
                        <button onclick="openFolderModal()" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">+ New Album</button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-amber-200">
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Album</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Photos</th>
                                    <th class="text-left py-3 px-4 text-amber-800 font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="galleryTableBody">
                                <tr>
                                    <td colspan="3" class="text-center py-8 text-amber-600">No albums yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalTitle" class="text-2xl font-bold text-gray-800">Add New Event</h2>
                <button onclick="closeEventModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="eventForm" onsubmit="handleEventSubmit(event)">
                <input type="hidden" id="eventId" value="">
                
                <div class="space-y-4">
                    <div>
                        <label for="eventName" class="block text-sm font-medium text-gray-700 mb-2">Event Name *</label>
                        <input type="text" id="eventName" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label for="eventDate" class="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                            <input type="date" id="eventDate" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        
                        <div>
                            <label for="eventTime" class="block text-sm font-medium text-gray-700 mb-2">Time *</label>
                            <input type="time" id="eventTime" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                    </div>
                    
                    <div>
                        <label for="eventLocation" class="block text-sm font-medium text-gray-700 mb-2">Location *</label>
                        <input type="text" id="eventLocation" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    
                    <div>
                        <label for="eventDescription" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="eventDescription" rows="4"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold flex-1">
                        Save Event
                    </button>
                    <button type="button" onclick="closeEventModal()" class="btn-secondary text-white px-6 py-3 rounded-lg font-semibold">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Folder Modal -->
    <div id="folderModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="folderModalTitle" class="text-2xl font-bold text-gray-800">New Album</h2>
                <button onclick="closeFolderModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="folderForm" onsubmit="handleFolderSubmit(event)">
                <input type="hidden" id="folderId" value="">
                <div class="space-y-4">
                    <div>
                        <label for="folderName" class="block text-sm font-medium text-gray-700 mb-2">Album Name *</label>
                        <input type="text" id="folderName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    <div>
                        <label for="folderDesc" class="block text-sm font-medium text-gray-700 mb-2">Description (optional)</label>
                        <textarea id="folderDesc" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold flex-1">Save Album</button>
                    <button type="button" onclick="closeFolderModal()" class="btn-secondary text-white px-6 py-3 rounded-lg font-semibold">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Images Modal -->
    <div id="imagesModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="imagesModalTitle" class="text-2xl font-bold text-gray-800">Manage Photos</h2>
                <button onclick="closeImagesModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="text" id="newImageUrl" placeholder="Paste image URL" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    <button onclick="addImageToFolder()" class="btn-primary text-white px-4 py-3 rounded-lg font-semibold">Add</button>
                </div>
                <div id="imagesList" class="space-y-2 max-h-[50vh] overflow-y-auto"></div>
                <div class="text-xs text-amber-700">Tip: Use direct image URLs (e.g., from an image host). First image becomes the album cover.</div>
            </div>
        </div>
    </div>

    <script>
        // Demo data storage (in production, this would be a backend database)
        let members = JSON.parse(localStorage.getItem('churchMembers')) || [];
        
        // Initialize with default events if none exist
        let events = JSON.parse(localStorage.getItem('churchEvents')) || [];
        if (events.length === 0) {
            events = [
                {
                    name: 'Christmas Service',
                    description: 'Join us for a special Christmas celebration with music, fellowship, and worship.',
                    date: '2024-12-15',
                    time: '10:00',
                    location: 'Main Sanctuary'
                },
                {
                    name: 'Community Outreach',
                    description: 'Help us serve meals to families in need during the holiday season.',
                    date: '2024-12-22',
                    time: '14:00',
                    location: 'Community Center'
                },
                {
                    name: 'New Year\'s Prayer',
                    description: 'Welcome the new year with prayer, reflection, and fellowship.',
                    date: '2024-12-31',
                    time: '23:00',
                    location: 'Main Sanctuary'
                }
            ];
            localStorage.setItem('churchEvents', JSON.stringify(events));
        }
        
        let messages = JSON.parse(localStorage.getItem('churchMessages')) || [];
    let donations = JSON.parse(localStorage.getItem('churchDonations')) || [];
        let gallery = JSON.parse(localStorage.getItem('churchGallery')) || [];
        if (gallery.length === 0) {
            gallery = [
                {
                    id: Date.now(),
                    name: 'Church Family',
                    description: 'Highlights from recent gatherings',
                    images: []
                }
            ];
            localStorage.setItem('churchGallery', JSON.stringify(gallery));
        }

        // Login handling
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Demo authentication (in production, use secure backend authentication)
            if (username === 'admin' && password === 'password') {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboardPage').classList.remove('hidden');
                document.getElementById('adminName').textContent = 'Admin User';
                updateDashboard();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        function handleLogout() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').classList.add('hidden');
        }

        // Section navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section + 'Section').classList.add('active');
            event.target.classList.add('active');
            
            // Update content
            if (section === 'members') loadMembers();
            if (section === 'events') loadEvents();
            if (section === 'messages') loadMessages();
            if (section === 'donations') loadDonations();
            if (section === 'gallery') loadGallery();
        }

        // Update dashboard stats
        function updateDashboard() {
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('totalEvents').textContent = events.length;
            document.getElementById('totalMessages').textContent = messages.length;
            document.getElementById('totalDonations').textContent = donations.length;
            
            loadMembers();
        }

        // Members management
        function loadMembers() {
            const tbody = document.getElementById('membersTableBody');
            
            if (members.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-amber-600">No members registered yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = members.map((member, index) => `
                <tr class="border-b border-amber-100">
                    <td class="py-3 px-4 text-amber-900">${member.firstName} ${member.lastName}</td>
                    <td class="py-3 px-4 text-amber-700">${member.email}</td>
                    <td class="py-3 px-4 text-amber-700">${member.phone || 'N/A'}</td>
                    <td class="py-3 px-4 text-amber-700">${member.ageGroup || 'N/A'}</td>
                    <td class="py-3 px-4 text-amber-700 text-sm">${member.interests ? member.interests.join(', ') : 'None'}</td>
                    <td class="py-3 px-4">
                        <button onclick="viewMember(${index})" class="text-blue-600 hover:text-blue-800 mr-2">View</button>
                        <button onclick="deleteMember(${index})" class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function searchMembers() {
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
            const filtered = members.filter(member => 
                member.firstName.toLowerCase().includes(searchTerm) ||
                member.lastName.toLowerCase().includes(searchTerm) ||
                member.email.toLowerCase().includes(searchTerm)
            );
            
            const tbody = document.getElementById('membersTableBody');
            tbody.innerHTML = filtered.map((member, index) => `
                <tr class="border-b border-amber-100">
                    <td class="py-3 px-4 text-amber-900">${member.firstName} ${member.lastName}</td>
                    <td class="py-3 px-4 text-amber-700">${member.email}</td>
                    <td class="py-3 px-4 text-amber-700">${member.phone || 'N/A'}</td>
                    <td class="py-3 px-4 text-amber-700">${member.ageGroup || 'N/A'}</td>
                    <td class="py-3 px-4 text-amber-700 text-sm">${member.interests ? member.interests.join(', ') : 'None'}</td>
                    <td class="py-3 px-4">
                        <button onclick="viewMember(${index})" class="text-blue-600 hover:text-blue-800 mr-2">View</button>
                        <button onclick="deleteMember(${index})" class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function viewMember(index) {
            const member = members[index];
            alert(`Member Details:\n\nName: ${member.firstName} ${member.lastName}\nEmail: ${member.email}\nPhone: ${member.phone || 'N/A'}\nAge Group: ${member.ageGroup || 'N/A'}\nInterests: ${member.interests ? member.interests.join(', ') : 'None'}\nHow they heard about us: ${member.source || 'N/A'}`);
        }

        function deleteMember(index) {
            if (confirm('Are you sure you want to remove this member?')) {
                members.splice(index, 1);
                localStorage.setItem('churchMembers', JSON.stringify(members));
                loadMembers();
                updateDashboard();
            }
        }

        // Events management
        function loadEvents() {
            const tbody = document.getElementById('eventsTableBody');
            
            if (events.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-amber-600">No events scheduled</td></tr>';
                return;
            }
            
            tbody.innerHTML = events.map((event, index) => `
                <tr class="border-b border-amber-100">
                    <td class="py-3 px-4 text-amber-900 font-medium">${event.name}</td>
                    <td class="py-3 px-4 text-amber-700">${event.date}</td>
                    <td class="py-3 px-4 text-amber-700">${event.time}</td>
                    <td class="py-3 px-4 text-amber-700">${event.location}</td>
                    <td class="py-3 px-4">
                        <button onclick="editEvent(${index})" class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button onclick="deleteEvent(${index})" class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function openEventModal(eventIndex = null) {
            document.getElementById('eventModal').classList.add('active');
            
            if (eventIndex !== null) {
                const event = events[eventIndex];
                document.getElementById('modalTitle').textContent = 'Edit Event';
                document.getElementById('eventId').value = eventIndex;
                document.getElementById('eventName').value = event.name;
                document.getElementById('eventDate').value = event.date;
                document.getElementById('eventTime').value = event.time;
                document.getElementById('eventLocation').value = event.location;
                document.getElementById('eventDescription').value = event.description || '';
            } else {
                document.getElementById('modalTitle').textContent = 'Add New Event';
                document.getElementById('eventId').value = '';
                document.getElementById('eventForm').reset();
            }
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('active');
            document.getElementById('eventForm').reset();
        }

        function editEvent(index) {
            openEventModal(index);
        }

        function handleEventSubmit(event) {
            event.preventDefault();
            
            const eventData = {
                name: document.getElementById('eventName').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                location: document.getElementById('eventLocation').value,
                description: document.getElementById('eventDescription').value
            };
            
            const eventId = document.getElementById('eventId').value;
            
            if (eventId === '') {
                // Adding new event
                events.push(eventData);
                alert('Event added successfully!');
            } else {
                // Editing existing event
                events[eventId] = eventData;
                alert('Event updated successfully!');
            }
            
            localStorage.setItem('churchEvents', JSON.stringify(events));
            loadEvents();
            closeEventModal();
            updateDashboard();
        }

        function deleteEvent(index) {
            if (confirm('Are you sure you want to delete this event?')) {
                events.splice(index, 1);
                localStorage.setItem('churchEvents', JSON.stringify(events));
                loadEvents();
                updateDashboard();
            }
        }

        // Messages management
        function loadMessages() {
            const container = document.getElementById('messagesContainer');
            
            if (messages.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-amber-600">No messages yet</div>';
                return;
            }
            
            container.innerHTML = messages.map((msg, index) => `
                <div class="border border-amber-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-semibold text-amber-900">${msg.name}</h4>
                            <p class="text-sm text-amber-600">${msg.email}</p>
                        </div>
                        <span class="text-xs bg-amber-100 text-amber-800 px-3 py-1 rounded-full">${msg.subject}</span>
                    </div>
                    <p class="text-amber-700 mb-3">${msg.message}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-amber-600">${msg.date}</span>
                        <button onclick="deleteMessage(${index})" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function filterMessages() {
            const filter = document.getElementById('messageFilter').value;
            const filtered = filter === 'all' ? messages : messages.filter(msg => msg.subject === filter);
            
            const container = document.getElementById('messagesContainer');
            container.innerHTML = filtered.map((msg, index) => `
                <div class="border border-amber-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-semibold text-amber-900">${msg.name}</h4>
                            <p class="text-sm text-amber-600">${msg.email}</p>
                        </div>
                        <span class="text-xs bg-amber-100 text-amber-800 px-3 py-1 rounded-full">${msg.subject}</span>
                    </div>
                    <p class="text-amber-700 mb-3">${msg.message}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-amber-600">${msg.date}</span>
                        <button onclick="deleteMessage(${index})" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteMessage(index) {
            if (confirm('Are you sure you want to delete this message?')) {
                messages.splice(index, 1);
                localStorage.setItem('churchMessages', JSON.stringify(messages));
                loadMessages();
                updateDashboard();
            }
        }

        // Donations management
        function loadDonations() {
            const tbody = document.getElementById('donationsTableBody');
            
            if (donations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-amber-600">No donations recorded</td></tr>';
                return;
            }
            
            tbody.innerHTML = donations.map((donation, index) => `
                <tr class="border-b border-amber-100">
                    <td class="py-3 px-4 text-amber-900">
                        ${donation.anonymous ? '<span class="italic">Anonymous</span>' : (donation.name || 'N/A')}
                        ${donation.message ? '<br><span class="text-xs text-amber-600">üí¨ Has message</span>' : ''}
                    </td>
                    <td class="py-3 px-4 text-amber-900 font-semibold">$${parseFloat(donation.amount).toFixed(2)}</td>
                    <td class="py-3 px-4 text-amber-700 capitalize">${donation.type}</td>
                    <td class="py-3 px-4 text-amber-700 capitalize">${donation.frequency}</td>
                    <td class="py-3 px-4">
                        <div class="text-amber-700">${donation.date}</div>
                        ${!donation.anonymous && donation.email ? `<div class="text-xs text-amber-600">${donation.email}</div>` : ''}
                    </td>
                </tr>
            `).join('');
            
            // Calculate totals
            const total = donations.reduce((sum, d) => sum + parseFloat(d.amount), 0);
            const average = total / donations.length;
            
            document.getElementById('monthlyTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('yearlyTotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('averageDonation').textContent = `$${average.toFixed(2)}`;
        }

        // Initialize dashboard
        updateDashboard();

        // --------- Gallery Management ---------
        function loadGallery() {
            const tbody = document.getElementById('galleryTableBody');
            if (!gallery || gallery.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-amber-600">No albums yet</td></tr>';
                return;
            }
            tbody.innerHTML = gallery.map((folder, idx) => `
                <tr class="border-b border-amber-100">
                    <td class="py-3 px-4">
                        <div class="flex items-center gap-3">
                            ${folder.images && folder.images[0] ? `<img src="${folder.images[0]}" class="w-14 h-14 object-cover rounded-lg" alt="cover">` : `<div class='w-14 h-14 rounded-lg bg-amber-50 border border-amber-200'></div>`}
                            <div>
                                <div class="text-amber-900 font-medium">${folder.name}</div>
                                <div class="text-xs text-amber-600">${folder.description || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4 text-amber-700">${(folder.images?.length || 0)}</td>
                    <td class="py-3 px-4">
                        <button onclick="openImagesModal(${idx})" class="text-blue-600 hover:text-blue-800 mr-3">Manage Photos</button>
                        <a href="gallery.html?folder=${encodeURIComponent(folder.id)}" target="_blank" class="text-amber-800 hover:underline mr-3">Open</a>
                        <button onclick="editFolder(${idx})" class="text-amber-700 hover:text-amber-900 mr-3">Edit</button>
                        <button onclick="deleteFolder(${idx})" class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function openFolderModal(index = null) {
            document.getElementById('folderModal').classList.add('active');
            if (index !== null) {
                const f = gallery[index];
                document.getElementById('folderModalTitle').textContent = 'Edit Album';
                document.getElementById('folderId').value = index;
                document.getElementById('folderName').value = f.name;
                document.getElementById('folderDesc').value = f.description || '';
            } else {
                document.getElementById('folderModalTitle').textContent = 'New Album';
                document.getElementById('folderId').value = '';
                document.getElementById('folderForm').reset();
            }
        }

        function closeFolderModal() {
            document.getElementById('folderModal').classList.remove('active');
            document.getElementById('folderForm').reset();
        }

        function handleFolderSubmit(e) {
            e.preventDefault();
            const payload = {
                id: Date.now(),
                name: document.getElementById('folderName').value.trim(),
                description: document.getElementById('folderDesc').value.trim(),
                images: []
            };
            const idx = document.getElementById('folderId').value;
            if (idx === '') {
                gallery.push(payload);
                alert('Album created');
            } else {
                const originalId = gallery[idx].id; // preserve id
                gallery[idx] = { ...payload, id: originalId, images: gallery[idx].images || [] };
                alert('Album updated');
            }
            localStorage.setItem('churchGallery', JSON.stringify(gallery));
            closeFolderModal();
            loadGallery();
        }

        function editFolder(index) { openFolderModal(index); }

        function deleteFolder(index) {
            if (confirm('Delete this album and all its photos?')) {
                gallery.splice(index, 1);
                localStorage.setItem('churchGallery', JSON.stringify(gallery));
                loadGallery();
            }
        }

        let imagesFolderIndex = null;
        function openImagesModal(index) {
            imagesFolderIndex = index;
            document.getElementById('imagesModal').classList.add('active');
            document.getElementById('imagesModalTitle').textContent = `Manage Photos ¬∑ ${gallery[index].name}`;
            renderImagesList();
        }
        function closeImagesModal() {
            imagesFolderIndex = null;
            document.getElementById('imagesModal').classList.remove('active');
            document.getElementById('newImageUrl').value = '';
            document.getElementById('imagesList').innerHTML = '';
        }
        function renderImagesList() {
            const list = document.getElementById('imagesList');
            const imgs = gallery[imagesFolderIndex].images || [];
            if (imgs.length === 0) {
                list.innerHTML = '<div class="text-amber-700">No photos yet.</div>';
                return;
            }
            list.innerHTML = imgs.map((src, i) => `
                <div class="flex items-center gap-3 border border-amber-200 rounded-lg p-2">
                    <img src="${src}" class="w-16 h-16 object-cover rounded" alt="img ${i+1}">
                    <div class="flex-1 text-sm text-amber-800 truncate">${src}</div>
                    ${i === 0 ? '<span class="text-xs text-amber-700 mr-2">Cover</span>' : ''}
                    <button onclick="moveImage(${i}, -1)" class="text-xs px-2 py-1 border rounded mr-1 disabled:opacity-40" ${i===0?'disabled':''}>Up</button>
                    <button onclick="moveImage(${i}, 1)" class="text-xs px-2 py-1 border rounded mr-1 disabled:opacity-40" ${i===imgs.length-1?'disabled':''}>Down</button>
                    <button onclick="removeImage(${i})" class="text-xs text-red-600">Remove</button>
                </div>
            `).join('');
        }
        function addImageToFolder() {
            const input = document.getElementById('newImageUrl');
            const url = input.value.trim();
            if (!url) return;
            gallery[imagesFolderIndex].images = gallery[imagesFolderIndex].images || [];
            gallery[imagesFolderIndex].images.push(url);
            localStorage.setItem('churchGallery', JSON.stringify(gallery));
            input.value = '';
            renderImagesList();
            loadGallery();
        }
        function removeImage(i) {
            gallery[imagesFolderIndex].images.splice(i,1);
            localStorage.setItem('churchGallery', JSON.stringify(gallery));
            renderImagesList();
            loadGallery();
        }
        function moveImage(i, dir) {
            const imgs = gallery[imagesFolderIndex].images;
            const j = i + dir;
            if (j < 0 || j >= imgs.length) return;
            [imgs[i], imgs[j]] = [imgs[j], imgs[i]];
            localStorage.setItem('churchGallery', JSON.stringify(gallery));
            renderImagesList();
            loadGallery();
        }
    </script>
</body>
</html>
